{"openapi":"3.1.0","info":{"title":"ObliqPay V3 Merchant API","description":"External Merchant API for ObliqPay hosted checkout","version":"3.0.0"},"paths":{"/health":{"get":{"summary":"Health Check","description":"Health check endpoint - returns 200 if service is healthy","operationId":"health_check_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/orders":{"post":{"tags":["orders"],"summary":"Create Order V3","description":"Create a new order and return checkout URL.\nMerchant must provide valid API key in Authorization header.","operationId":"create_order_v3_orders_post","parameters":[{"name":"authorization","in":"header","required":false,"schema":{"type":"string","default":"","title":"Authorization"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateOrderV3Request"}}}},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateOrderV3Response"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/orders/{order_id}":{"get":{"tags":["orders"],"summary":"Get Order Status V3","description":"Get order status by internal order UUID.\nOnly returns orders belonging to the authenticated merchant.","operationId":"get_order_status_v3_orders__order_id__get","parameters":[{"name":"order_id","in":"path","required":true,"schema":{"type":"string","title":"Order Id"}},{"name":"authorization","in":"header","required":false,"schema":{"type":"string","default":"","title":"Authorization"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/OrderStatusV3Response"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/order_checkout/{order_id}":{"get":{"tags":["checkout"],"summary":"Get Checkout Order","description":"Public endpoint to get order details and iframe URL for checkout page.\nUses internal UUID (same as order_id returned by create order endpoint).\nNo authentication required - this is for the public checkout page.\n\nValidates parent_origin against merchant's whitelisted iframe domains.\nThe frontend should pass document.referrer as parent_origin query param.","operationId":"get_checkout_order_order_checkout__order_id__get","parameters":[{"name":"order_id","in":"path","required":true,"schema":{"type":"string","title":"Order Id"}},{"name":"parent_origin","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Parent Origin"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CheckoutOrderResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/iframe/iframe/token":{"post":{"tags":["v3-iframe"],"summary":"Generate V3 Iframe Token","description":"Generate a signed token for iframe checkout access for V3 orders.\n\nThis token is used to authorize access to the checkout page\nhosted on thefivve.com when embedded as an iframe.\n\nThe token expires after a configurable TTL (default: 5 minutes).","operationId":"generate_v3_iframe_token_iframe_iframe_token_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/V3IframeTokenRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/V3IframeTokenResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/iframe/domains":{"get":{"tags":["iframe-domains"],"summary":"Get Iframe Domains","description":"Get all whitelisted iframe domains for the authenticated merchant.","operationId":"get_iframe_domains_iframe_domains_get","parameters":[{"name":"authorization","in":"header","required":false,"schema":{"type":"string","default":"","title":"Authorization"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/IframeDomainsListResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"post":{"tags":["iframe-domains"],"summary":"Add Iframe Domain","description":"Add a domain to the merchant's iframe whitelist.\nMaximum of 3 domains allowed per merchant.\nSupports wildcard subdomains (e.g., *.example.com).","operationId":"add_iframe_domain_iframe_domains_post","parameters":[{"name":"authorization","in":"header","required":false,"schema":{"type":"string","default":"","title":"Authorization"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AddIframeDomainRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AddIframeDomainResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/iframe/domains/{domain}":{"delete":{"tags":["iframe-domains"],"summary":"Remove Iframe Domain","description":"Remove a domain from the merchant's iframe whitelist.","operationId":"remove_iframe_domain_iframe_domains__domain__delete","parameters":[{"name":"domain","in":"path","required":true,"schema":{"type":"string","title":"Domain"}},{"name":"authorization","in":"header","required":false,"schema":{"type":"string","default":"","title":"Authorization"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/webhook/secret/exists":{"get":{"tags":["webhook"],"summary":"Check Webhook Secret Exists","description":"Check whether a webhook signing secret is already configured for the\nauthenticated merchant.\n\nThis endpoint **never** reveals the actual secret.  It is designed so\nthat WooCommerce plugin installations on 2nd / 3rd sites can detect\nthat a secret already exists and prompt the merchant to re-enter the\nsame secret rather than generating a new one (which would invalidate\nthe secret on earlier sites).","operationId":"check_webhook_secret_exists_webhook_secret_exists_get","parameters":[{"name":"authorization","in":"header","required":false,"schema":{"type":"string","default":"","title":"Authorization"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/WebhookSecretExistsResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/webhook/secret":{"post":{"tags":["webhook"],"summary":"Create Webhook Secret","description":"Generate a new webhook signing secret for the authenticated merchant.\n\n**Multi-site safety** — by default this endpoint refuses to overwrite\nan existing secret, returning **409 Conflict** instead.  This prevents\nthe common multi-site pitfall where generating a secret from a 2nd\nWooCommerce site silently invalidates the secret on the 1st site.\n\nPass ``?force=true`` to explicitly rotate the secret.  After rotation\nyou **must** update the ``webhook_secret`` setting on **every**\nWooCommerce site that shares this API key.\n\n* The raw secret is returned **only once** in this response — store it\n  securely on your server.\n* All subsequent outgoing webhooks to your ``webhook_url`` will include\n  ``X-ObliqPay-Signature`` and ``X-ObliqPay-Timestamp`` headers signed\n  with this secret.","operationId":"create_webhook_secret_webhook_secret_post","parameters":[{"name":"force","in":"query","required":false,"schema":{"type":"boolean","description":"When false (default), the endpoint will NOT overwrite an existing secret — it returns HTTP 409 instead.  Set to true to force-rotate the secret (you must then update ALL WooCommerce sites).","default":false,"title":"Force"},"description":"When false (default), the endpoint will NOT overwrite an existing secret — it returns HTTP 409 instead.  Set to true to force-rotate the secret (you must then update ALL WooCommerce sites)."},{"name":"authorization","in":"header","required":false,"schema":{"type":"string","default":"","title":"Authorization"}}],"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/WebhookSecretResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"tags":["webhook"],"summary":"Delete Webhook Secret","description":"Remove the webhook signing secret for the authenticated merchant.\n\nAfter deletion, outgoing webhooks will be sent **unsigned**.","operationId":"delete_webhook_secret_webhook_secret_delete","parameters":[{"name":"authorization","in":"header","required":false,"schema":{"type":"string","default":"","title":"Authorization"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/WebhookSecretDeletedResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/merchant/branding":{"get":{"tags":["merchant-branding"],"summary":"Get Merchant Branding V3","description":"Get branding configuration for the authenticated merchant.\nReturns brand name and logo URL if branded checkout is enabled.","operationId":"get_merchant_branding_v3_merchant_branding_get","parameters":[{"name":"authorization","in":"header","required":false,"schema":{"type":"string","default":"","title":"Authorization"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/MerchantBrandingV3Response"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/refund/{order_uuid}":{"get":{"tags":["refund"],"summary":"Get Refund Info","description":"Returns the order summary needed to render the refund form.\nReturns 404 when the order doesn't exist or hasn't been paid yet.","operationId":"get_refund_info_refund__order_uuid__get","parameters":[{"name":"order_uuid","in":"path","required":true,"schema":{"type":"string","title":"Order Uuid"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"post":{"tags":["refund"],"summary":"Submit Refund","description":"Stores a customer refund request and triggers the downstream effects:\n- Marks the order as refund_requested\n- Increments merchant risk score\n- Sends a Telegram admin alert","operationId":"submit_refund_refund__order_uuid__post","parameters":[{"name":"order_uuid","in":"path","required":true,"schema":{"type":"string","title":"Order Uuid"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RefundSubmitRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/":{"get":{"summary":"Root","operationId":"root__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"AddIframeDomainRequest":{"properties":{"domain":{"type":"string","title":"Domain","description":"Domain to whitelist (e.g., 'example.com' or '*.example.com')"}},"type":"object","required":["domain"],"title":"AddIframeDomainRequest","description":"Request model for adding an iframe domain"},"AddIframeDomainResponse":{"properties":{"success":{"type":"boolean","title":"Success"},"domain":{"type":"string","title":"Domain"},"message":{"type":"string","title":"Message"}},"type":"object","required":["success","domain","message"],"title":"AddIframeDomainResponse","description":"Response model for adding an iframe domain"},"CheckoutOrderResponse":{"properties":{"order_id":{"type":"string","title":"Order Id"},"provider_order_id":{"type":"string","title":"Provider Order Id"},"client_secret":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Client Secret"},"amount":{"type":"number","title":"Amount"},"currency":{"type":"string","title":"Currency"},"email":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Email"},"status":{"type":"string","title":"Status"},"iframe_url":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Iframe Url"},"redirect_url":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Redirect Url"},"brand_logo_url":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Brand Logo Url"},"brand_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Brand Name"}},"type":"object","required":["order_id","provider_order_id","amount","currency","status"],"title":"CheckoutOrderResponse","description":"Response model for checkout order details with iframe URL"},"CreateOrderV3Request":{"properties":{"amount":{"type":"number","exclusiveMinimum":0.0,"title":"Amount","description":"Payment amount (must be greater than 0)"},"currency":{"type":"string","title":"Currency","description":"Payment currency (e.g., 'usd', 'eur', 'gbp')"},"email":{"anyOf":[{"type":"string","format":"email"},{"type":"null"}],"title":"Email","description":"Customer email (optional, will be generated if not provided)"},"webhook_url":{"anyOf":[{"type":"string","maxLength":2083,"minLength":1,"format":"uri"},{"type":"null"}],"title":"Webhook Url","description":"Webhook URL to notify when payment is completed (optional)"},"redirect_url":{"anyOf":[{"type":"string","maxLength":2083,"minLength":1,"format":"uri"},{"type":"null"}],"title":"Redirect Url","description":"URL to redirect user after successful payment (optional)"},"note":{"anyOf":[{"type":"string","maxLength":65535},{"type":"null"}],"title":"Note","description":"Optional note or memo for the order (e.g., product details, internal reference)"}},"type":"object","required":["amount","currency"],"title":"CreateOrderV3Request","description":"Request model for creating an order via v3 API","example":{"amount":100.0,"currency":"usd","email":"customer@example.com","note":"Order #1234 - Premium Plan","redirect_url":"https://merchant.com/thank-you","webhook_url":"https://merchant.com/webhook"}},"CreateOrderV3Response":{"properties":{"orderId":{"type":"string","title":"Orderid","description":"Internal order UUID"},"checkoutUrl":{"type":"string","title":"Checkouturl","description":"URL to redirect customer for payment"},"expiresAt":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Expiresat","description":"Order expiration timestamp"},"paymentProcessor":{"type":"string","enum":["nova","waygate","virex","setupupi","aether1"],"title":"Paymentprocessor","description":"Payment processor used for this order (nova, waygate, virex, setupupi, or aether1)","default":"nova"},"backupProcessor":{"anyOf":[{"type":"string","enum":["nova","waygate","virex","setupupi","aether1"]},{"type":"null"}],"title":"Backupprocessor","description":"Backup payment processor if primary fails (nova, waygate, virex, setupupi, aether1, or null)"},"checkoutType":{"type":"string","enum":["embedded","redirect"],"title":"Checkouttype","description":"Type of checkout: 'embedded' for Nova (card details collected on checkout page), 'redirect' for Waygate/Virex","default":"embedded"}},"type":"object","required":["orderId","checkoutUrl"],"title":"CreateOrderV3Response","description":"Response model for order creation","example":{"backupProcessor":"waygate","checkoutType":"embedded","checkoutUrl":"https://v3.obliqpay.com/order_checkout/cm_order_abc123","expiresAt":"2024-01-01T12:00:00Z","orderId":"550e8400-e29b-41d4-a716-446655440000","paymentProcessor":"nova"}},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"IframeDomainsListResponse":{"properties":{"domains":{"items":{"type":"string"},"type":"array","title":"Domains"},"count":{"type":"integer","title":"Count"},"max_allowed":{"type":"integer","title":"Max Allowed","default":3}},"type":"object","required":["domains","count"],"title":"IframeDomainsListResponse","description":"Response model for listing iframe domains"},"MerchantBrandingV3Response":{"properties":{"branded_checkout_enabled":{"type":"boolean","title":"Branded Checkout Enabled","default":false},"brand_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Brand Name"},"brand_logo_url":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Brand Logo Url"}},"type":"object","title":"MerchantBrandingV3Response","description":"Response model for merchant branding info"},"OrderStatusV3Response":{"properties":{"orderId":{"type":"string","title":"Orderid","description":"Internal order UUID"},"status":{"type":"string","title":"Status","description":"Overall order status: pending, completed, failed"},"amount":{"type":"number","title":"Amount","description":"Order amount"},"currency":{"type":"string","title":"Currency","description":"Order currency"},"paymentStatus":{"type":"string","title":"Paymentstatus","description":"Payment status"},"deliveryStatus":{"type":"string","title":"Deliverystatus","description":"Delivery status"},"createdAt":{"type":"string","format":"date-time","title":"Createdat","description":"Order creation timestamp"},"completedAt":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Completedat","description":"Order completion timestamp"},"merchantSettlementTxHash":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Merchantsettlementtxhash","description":"Settlement transaction hash (if settled)"},"note":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Note","description":"Note or memo attached to the order"}},"type":"object","required":["orderId","status","amount","currency","paymentStatus","deliveryStatus","createdAt"],"title":"OrderStatusV3Response","description":"Response model for order status"},"RefundSubmitRequest":{"properties":{"reason":{"type":"string","title":"Reason"},"bank_region":{"type":"string","title":"Bank Region"},"bank_account_holder":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Bank Account Holder"},"bank_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Bank Name"},"bank_account_number":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Bank Account Number"},"bank_routing_number":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Bank Routing Number"},"bank_iban":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Bank Iban"},"bank_swift":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Bank Swift"},"paypal_email":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Paypal Email"}},"type":"object","required":["reason","bank_region"],"title":"RefundSubmitRequest"},"V3IframeTokenRequest":{"properties":{"order_id":{"type":"string","title":"Order Id"},"crossmint_order_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Crossmint Order Id"},"amount":{"type":"string","title":"Amount"},"currency":{"type":"string","title":"Currency"},"merchant":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Merchant"},"token_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Token Id"},"processor":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Processor"}},"type":"object","required":["order_id","amount","currency"],"title":"V3IframeTokenRequest","description":"Request to generate an iframe access token for V3 order."},"V3IframeTokenResponse":{"properties":{"token":{"type":"string","title":"Token"},"iframe_url":{"type":"string","title":"Iframe Url"},"expires_in":{"type":"integer","title":"Expires In"}},"type":"object","required":["token","iframe_url","expires_in"],"title":"V3IframeTokenResponse","description":"Response containing the iframe URL with token."},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"},"WebhookSecretDeletedResponse":{"properties":{"message":{"type":"string","title":"Message"}},"type":"object","required":["message"],"title":"WebhookSecretDeletedResponse","description":"Returned when the webhook secret is removed."},"WebhookSecretExistsResponse":{"properties":{"exists":{"type":"boolean","title":"Exists"},"message":{"type":"string","title":"Message"}},"type":"object","required":["exists","message"],"title":"WebhookSecretExistsResponse","description":"Returned by the /secret/exists endpoint."},"WebhookSecretResponse":{"properties":{"secret":{"type":"string","title":"Secret"},"message":{"type":"string","title":"Message"},"created":{"type":"boolean","title":"Created","default":true}},"type":"object","required":["secret","message"],"title":"WebhookSecretResponse","description":"Returned when a new webhook secret is generated."}}}}